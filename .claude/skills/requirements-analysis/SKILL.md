---
name: requirements-analysis
description: |
  제공된 요구사항을 사용자 니즈 → 기능 명세로 전환하고,
  유스케이스(Main/Alternate/Exception)와 유비쿼터스 언어를 정리한 뒤,
  설계 산출물(요구사항, 시퀀스, 클래스, ERD)을 Mermaid로 작성한다.
  추측으로 빈칸을 채우지 않고, 결정 필요 사항을 질문/선택지로 끌어낸다.
---

# requirements-analysis Skill

## 0) 기본 원칙
- 요구사항을 문장 요약으로 끝내지 않는다. **사용자 니즈를 기능 명세로 변환**한다.
- 예외/조건이 빠진 요구사항은 무조건 실패다. **Main/Alternate/Exception Flow**를 강제한다.
- 추측 금지. 합의되지 않은 것은 **"결정 필요"**로 남기고 질문으로 해결한다.
- 문서/코드/DB/API 용어가 흔들리면 설계는 무너진다. **용어 정합성**을 강제한다.
- 다이어그램은 그림이 아니라 검증 도구다. **검증 목적 → 다이어그램 → 해석** 순서로만 작성한다.

---

## 1) 사용자 니즈를 문제 상황으로 재서술
요구사항을 아래 3관점으로 5~12줄 작성한다.
- 사용자 관점: 사용자가 무엇을 하려다 어떤 불편/위험이 생기는가?
- 비즈니스 관점: 무엇을 보장/최적화하려는가? (품질/속도/리스크/운영)
- 시스템 관점: 어떤 일관성/권한/신뢰성이 필요한가?

> 금지: 원문을 문장 바꿔치기하는 요약.

---

## 2) 유저 시나리오 → 행위 중심 기능 목록
기능을 "행위(동사)+대상(명사)+조건" 형태로 쪼갠다.
- 예: "등록한다"가 아니라 "로그인한 사용자가 X를 Y 조건에서 생성한다"

---

## 3) 유스케이스 흐름 작성 (추상 금지)
각 유스케이스는 반드시 아래 구조를 따른다.

### 3-1. Main Flow (필수)
각 단계는 최소 3요소를 포함해야 한다.
- 입력(요청/커맨드)
- 검증(권한/존재/형식/중복)
- 상태 변화(생성/변경/삭제/전이)
- 저장/조회(영속화/조회 근거)
- 응답(반환 데이터/상태코드)

> 금지 표현: "처리한다", "저장한다" 같은 대상 없는 동사

### 3-2. Alternate Flow (필수 1개 이상)
- 조건이 달라질 때의 정상 대안 흐름
- 예: "이미 존재할 때 토글된다", "옵션에 따라 분기된다"

### 3-3. Exception Flow (필수 1개 이상)
아래를 최소 세트로 포함한다.
- 권한 없음 / 인증 실패
- 대상 없음(존재하지 않음)
- 중복/충돌(이미 존재, 동시 요청 등)
- 입력 검증 실패

> 예외는 "에러 발생"으로 끝내지 말고, **후속 동작(롤백/무시/보상/메시지)** 를 명시한다.

---

## 4) 자주 빠지는 조건을 체크리스트로 강제 (실수 방지 장치)
각 유스케이스마다 아래 질문에 답이 없으면 "미완" 처리한다.
- 이 기능은 **누가** 할 수 있는가? (권한/가시성)
- "없을 때/이미 있을 때/중복일 때" 동작은?
- 동시 요청이 오면 **무엇을 보장**해야 하는가? (원자성/순서/멱등)
- 실패 시 **데이터는 어떤 상태**여야 하는가? (롤백/부분 성공/보상)

---

## 5) 유비쿼터스 언어 (용어 정합성 강제)
용어집을 만들고 아래 규칙을 따른다.
- 각 용어는 (한글/영문), 정의(1~2줄), 금지 동의어(있다면)를 포함한다.
- 요구사항/ERD/API/클래스 명에 **동일 용어를 사용**한다.
- 축약어는 원칙적으로 금지. 필요하면 축약 사전을 만든다.
- 상태(enum)는 "상태1" 금지. **의미 있는 상태명**으로 정의하고 허용 전이를 문서화한다.

---

## 6) 결정 필요 사항을 질문으로 전환 (추측 금지)
애매한 요구사항을 다음 분류로 모은다.
- 정책: 성공/실패, 기준 시점, 정렬/필터 정의, 예외 규칙
- 경계: 책임/소유권, 기능 분리 기준, 접근 정책 충돌 여부
- 정합성/동시성: 멱등, 원자성, 충돌 처리, 부분 성공 여부
- 확장: 가까운 미래 변경 가능성(정책/기능/데이터)

질문 작성 형식:
- [P0] 결정 안 하면 설계가 성립 안 함
- [P1] 성능/운영 리스크 큼
- [P2] 개선/정교화

각 질문은 반드시 선택지(A/B...)와 영향도(구현/정합성/운영)를 포함한다.

---

## 7) Decision Log로 합의 사항을 고정 (문서-구현 이격 방지)
문서 상단에 Decision Log를 만들고 아래를 기록한다.
- 용어 정의/기준(정렬/기간/상태 등)
- 권한/가시성 규칙
- 데이터 변경 정책(삭제, 변경 불가 규칙, 상태 전이)
- 정합성/동시성 규칙(원자성, 멱등, 충돌 처리)
- 실패 처리/후속 동작(롤백, 보상, 재시도)

> 합의되지 않은 항목은 "미결정"으로 둔다. 임의로 채우지 않는다.

---

## 8) 다이어그램 작성 규칙 (복잡도/유지보수 실수 방지)
모든 다이어그램은 아래 순서를 따른다.
1) 검증 목적(2~4줄): 무엇을 검증하려고 그리는가?
2) 다이어그램(Mermaid)
3) 해석(2~5줄): 특히 봐야 할 포인트, 경계/책임/트랜잭션

### 8-1. 시퀀스 다이어그램 (최소 2개)
- 너무 많은 세부를 넣지 않는다.
- 원칙: **핵심 성공 흐름 + 대표 실패 흐름 1개**만 담는다.
- Controller → Application/Service → Domain → Infra 흐름에서
  "상태 변화"는 도메인 책임이 드러나게 표현한다.

### 8-2. 클래스 다이어그램/도메인 모델
- 모든 필드를 객체화하지 않는다.
- VO는 "불변 + 규칙(검증/연산)"이 있는 경우에만 도입한다.
- 서비스는 오케스트레이션, 도메인은 규칙/상태 변화 중심으로 책임을 분리한다.

### 8-3. ERD
- 흐름 없이 정규화만 추구하지 않는다.
- ERD 작성 전 "핵심 조회 3개"를 뽑고, 그 조회 관점으로 구조를 검증한다.
- 상태 컬럼 없이 코드 하드코딩 금지: 상태/전이를 데이터로 표현한다.
- 비정규화가 필요하면 이유(조회/이력/스냅샷)를 1~2줄로 명시한다.

---

## 9) 리스크를 반드시 문서화 (정답 제시 금지)
최소 5개 이상의 리스크를 작성한다.
형식:
- 리스크(무슨 문제가 생기는가)
- 증상(언제/어떻게 나타나는가)
- 완화 선택지(A/B, trade-off 포함)

---

## 산출물 가이드 (프로젝트 docs/design/)
- 01-requirements.md: 시나리오/기능/유스케이스/Decision Log/예외/정합성 규칙
- 02-sequence-diagrams.md: 검증 목적 포함 시퀀스 2개 이상
- 03-class-diagram.md: 책임/경계/불변 규칙 중심 모델
- 04-erd.md: ERD + 제약/인덱스 후보 + 상태/삭제 정책

---

## 톤
- 설계 리뷰 톤.
- 정답 단정 금지. 선택지와 trade-off를 함께 제시한다.
- "결정 필요"를 숨기지 않는다.
